"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3730],{67568:function(e,a,t){t.d(a,{DataProvider:function(){return v},e:function(){return m}});var i=t(57437),r=t(2265),n=t(93759),s=t(89506),l=t(56452),o=t(69842),c=t(20751);let u={institutionName:"Mi Instituci\xf3n",logo:"",theme:"theme-candy",apiKey:"",signature:"",facilitatorName:"",scheduleImageUrl:"",teacherPhoto:"",whatsappContactNumber:"",aiModel:c.Q6},d={grades:{},attendance:{},participations:{},activities:[],activityRecords:{},recoveryGrades:{},feedbacks:{},groupAnalysis:""},p=e=>{let a=(0,c.GN)(e.aiModel);return a===e.aiModel?e:{...e,aiModel:a}},f=(0,r.createContext)(void 0),v=e=>{let{children:a}=e,[t,c]=(0,r.useState)(!0),[v,m]=(0,r.useState)(null),[g,h]=(0,l.F_)(s.I),[w,y]=(0,r.useState)([]),[b,k]=(0,r.useState)([]),[C,_]=(0,r.useState)({}),[D,G]=(0,r.useState)([]),[S,I]=(0,r.useState)({}),[M,P]=(0,r.useState)(u),[O,E]=(0,r.useState)(null),[F,j]=(0,r.useState)("p1");(0,r.useEffect)(()=>{h||(async()=>{c(!0);try{let e=async e=>{if(g)try{let a=(0,o.JU)(s.db,"users",g.uid,"userData",e),t=await (0,o.QT)(a);if(t.exists())return console.log("Loaded ".concat(e," from Firestore")),t.data().value}catch(a){console.error("Error loading ".concat(e," from Firestore:"),a)}return(0,n.U2)(e)},[a,t,i,r,l,c,d]=await Promise.all([e("app_groups"),e("app_students"),e("app_observations"),e("app_specialNotes"),e("app_partialsData"),e("app_settings"),(0,n.U2)("activeGroupId_v1")]);y(a||[]),k(t||[]),_(i||{}),G(r||[]),I(l||{});let f=p(c||u);P(f),c&&f.aiModel!==c.aiModel&&(0,n.t8)("app_settings",f),d&&(a||[]).some(e=>e.id===d)?E(d):(a||[]).length>0?E(a[0].id):E(null)}catch(e){console.error("Data hydration error:",e),m(e instanceof Error?e:Error("An unknown error occurred during data hydration"))}finally{c(!1)}})()},[g,h]);let N=(e,a,t)=>async i=>{let r="function"==typeof i?i(t):i;if(e(r),await (0,n.t8)(a,r),g)try{let e=(0,o.JU)(s.db,"users",g.uid,"userData",a);await (0,o.pl)(e,{value:r},{merge:!0}),console.log("Saved ".concat(a," to Firestore"))}catch(e){console.error("Error saving ".concat(a," to Firestore:"),e)}},U=N(y,"app_groups",w),x=N(k,"app_students",b),A=N(_,"app_observations",C),R=N(G,"app_specialNotes",D),B=N(I,"app_partialsData",S),V=(0,r.useCallback)(async e=>{let a=p(e);P(a),await (0,n.t8)("app_settings",a)},[]),T=(0,r.useCallback)(async e=>{E(e),e?await (0,n.t8)("activeGroupId_v1",e):await (0,n.IV)("activeGroupId_v1")},[]),Z=(0,r.useMemo)(()=>O&&w.find(e=>e.id===O)||null,[w,O]),K=(0,r.useMemo)(()=>Array.from(new Map(w.flatMap(e=>e.students.map(e=>[e.id,e]))).values()),[w]),L=(0,r.useMemo)(()=>S[O||""]||{},[S,O]),Q=(0,r.useMemo)(()=>L[F]||d,[L,F]),W=(0,r.useCallback)(e=>async a=>{O&&B(t=>{let i=t[O]||{},r=i[F]||d,s="function"==typeof a?a(r[e]):a,l={...r,[e]:s},o={...i,[F]:l},c={...t,[O]:o};return(0,n.t8)("app_partialsData",c),c})},[O,F,B]),z=W("grades"),H=W("attendance"),J=W("participations"),q=W("activities"),X=W("activityRecords"),Y=W("recoveryGrades"),$=(0,r.useCallback)(async(e,a)=>{O&&B(t=>{let i=t[O]||{},r=i[F]||d,s={...r.feedbacks||{},[e]:a},l={...t,[O]:{...i,[F]:{...r,feedbacks:s}}};return(0,n.t8)("app_partialsData",l),l})},[O,F,B]),ee=(0,r.useCallback)(async e=>{O&&B(a=>{let t=a[O]||{},i=t[F]||d,r={...a,[O]:{...t,[F]:{...i,groupAnalysis:e}}};return(0,n.t8)("app_partialsData",r),r})},[O,F,B]),ea=(0,r.useCallback)(async(e,a)=>{await x(e=>[...e,...a.filter(a=>!e.some(e=>e.id===a.id))]),await U(t=>t.map(t=>t.id===e?{...t,students:[...t.students,...a]}:t))},[x,U]),et=(0,r.useCallback)(async(e,a)=>{await U(t=>t.map(t=>t.id===e?{...t,students:t.students.filter(e=>e.id!==a)}:t))},[U]),ei=(0,r.useCallback)(async(e,a)=>{await U(t=>t.map(t=>t.id===e?{...t,...a}:t))},[U]),er=(0,r.useCallback)(async(e,a)=>{await x(t=>t.map(t=>t.id===e?{...t,...a}:t)),await U(t=>t.map(t=>({...t,students:t.students.map(t=>t.id===e?{...t,...a}:t)})))},[x,U]),en=(0,r.useCallback)(async e=>{O&&await U(a=>a.map(a=>a.id===O?{...a,criteria:e}:a))},[O,U]),es=(0,r.useCallback)(async e=>{await U(a=>a.filter(a=>a.id!==e)),O===e&&T(null)},[O,U,T]),el=(0,r.useCallback)(async e=>{let a={...e,id:"OBS-".concat(Date.now()),date:new Date().toISOString(),followUpUpdates:[],isClosed:!1};await A(t=>({...t,[e.studentId]:[...t[e.studentId]||[],a]}))},[A]),eo=(0,r.useCallback)(async(e,a,t,i)=>{await A(r=>({...r,[e]:(r[e]||[]).map(e=>e.id===a?{...e,followUpUpdates:[...e.followUpUpdates,{date:new Date().toISOString(),update:t}],isClosed:i}:e)}))},[A]),ec=(0,r.useCallback)(async(e,a)=>{let t=w.find(a=>a.id===e);t&&B(i=>{let r=i[e]||{},s=r[F]||d;if(s.attendance[a])return i;let l=t.students.reduce((e,a)=>({...e,[a.id]:!0}),{}),o={...i,[e]:{...r,[F]:{...s,attendance:{...s.attendance,[a]:l},participations:{...s.participations,[a]:{}}}}};return(0,n.t8)("app_partialsData",o),o})},[w,F,B]),eu=(0,r.useCallback)(async e=>{O&&B(a=>{let t=a[O]||{},i=t[F]||d,{[e]:r,...s}=i.attendance,{[e]:l,...o}=i.participations,c={...a,[O]:{...t,[F]:{...i,attendance:s,participations:o}}};return(0,n.t8)("app_partialsData",c),c})},[O,F,B]),ed=(0,r.useCallback)(async()=>{c(!0);try{await (0,n.ZH)(),setTimeout(()=>window.location.reload(),500)}catch(e){m(e)}},[]),ep=(0,r.useCallback)(async e=>{if(!e.version||!e.groups||!e.students||!e.settings)throw Error("Archivo de importaci\xf3n inv\xe1lido o corrupto.");await (0,n.ZH)(),await (0,n.t8)("app_groups",e.groups||[]),await (0,n.t8)("app_students",e.students||[]),await (0,n.t8)("app_observations",e.observations||{}),await (0,n.t8)("app_specialNotes",e.specialNotes||[]),await (0,n.t8)("app_settings",e.settings),await (0,n.t8)("app_partialsData",e.partialsData||{}),e.groups&&e.groups.length>0&&await (0,n.t8)("activeGroupId_v1",e.groups[0].id)},[]),ef=(0,r.useCallback)(async e=>{let a={...e,id:"NOTE-".concat(Date.now())};await R(e=>[...e,a])},[R]),ev=(0,r.useCallback)(async(e,a)=>{await R(t=>t.map(t=>t.id===e?{...t,...a}:t))},[R]),em=(0,r.useCallback)(async e=>{await R(a=>a.filter(a=>a.id!==e))},[R]),eg=(0,r.useCallback)((e,a,t)=>{var i,r,n;let s=null===(i=a.recoveryGrades)||void 0===i?void 0:i[e];if(null==s?void 0:s.applied)return{finalGrade:null!==(r=s.grade)&&void 0!==r?r:0,criteriaDetails:[{name:"Recuperaci\xf3n",earned:null!==(n=s.grade)&&void 0!==n?n:0,weight:100}],isRecovery:!0};if(!a||!t||0===t.length)return{finalGrade:0,criteriaDetails:[],isRecovery:!1};let l=0,o=[];return t.forEach(t=>{var i,r,n,s,c,u,d;let p=0;if("Actividades"===t.name||"Portafolio"===t.name){let t=null!==(n=null===(i=a.activities)||void 0===i?void 0:i.length)&&void 0!==n?n:0;t>0&&(p=Object.values((null===(r=a.activityRecords)||void 0===r?void 0:r[e])||{}).filter(Boolean).length/t)}else if("Participaci\xf3n"===t.name){let t=Object.keys(a.participations||{}).length;t>0&&(p=Object.values(a.participations).filter(a=>a[e]).length/t)}else{let i=null!==(d=null===(u=a.grades)||void 0===u?void 0:null===(c=u[e])||void 0===c?void 0:null===(s=c[t.id])||void 0===s?void 0:s.delivered)&&void 0!==d?d:0;t.expectedValue>0&&(p=i/t.expectedValue)}let f=p*t.weight;l+=f,o.push({name:t.name,earned:f,weight:t.weight})}),{finalGrade:Math.max(0,Math.min(100,l)),criteriaDetails:o,isRecovery:!1}},[]),eh=(0,r.useCallback)(e=>{var a;return Z?eg(e,(null===(a=S[Z.id])||void 0===a?void 0:a[F])||d,(null==Z?void 0:Z.criteria)||[]).finalGrade:0},[Z,F,S,eg]),ew=(0,r.useCallback)((e,a,t)=>{let i=Object.keys(a).filter(e=>Object.prototype.hasOwnProperty.call(a[e],t)),r=i.reduce((e,i)=>!0===a[i][t]?e+1:e,0),n=i.length>0?r/i.length*100:100,s=[];return(e<=59&&s.push("Calificaci\xf3n reprobatoria (".concat(e.toFixed(0),"%).")),n<80&&s.push("Asistencia baja (".concat(n.toFixed(0),"%).")),s.length>0)?{level:"high",reason:s.join(" ")}:e>59&&e<=70?{level:"medium",reason:"Calificaci\xf3n baja (".concat(e.toFixed(0),"%).")}:{level:"low",reason:"Rendimiento adecuado"}},[]),ey=(0,r.useMemo)(()=>w.reduce((e,a)=>{var t;let i=null===(t=S[a.id])||void 0===t?void 0:t[F];if(!i||!a.criteria||0===a.criteria.length)return e[a.id]=0,e;let r=a.students.map(e=>eg(e.id,i,a.criteria).finalGrade);return e[a.id]=r.length>0?r.reduce((e,a)=>e+a,0)/r.length:0,e},{}),[w,F,S,eg]),eb=(0,r.useMemo)(()=>w.flatMap(e=>{var a;let t=null===(a=S[e.id])||void 0===a?void 0:a[F];return t&&e.criteria&&0!==e.criteria.length?e.students.map(a=>{let i=ew(eg(a.id,t,e.criteria).finalGrade,t.attendance,a.id);return{...a,calculatedRisk:i}}).filter(e=>"low"!==e.calculatedRisk.level):[]}).filter((e,a,t)=>t.findIndex(a=>a.id===e.id)===a),[w,F,S,eg,ew]),ek=(0,r.useMemo)(()=>{if(!Z)return 100;let e=0,a=0,t=Q.attendance;return(Z.students.forEach(i=>{Object.keys(t).forEach(r=>{Object.prototype.hasOwnProperty.call(t[r],i.id)&&(e++,t[r][i.id]&&a++)})}),0===e)?100:a/e*100},[Z,Q.attendance]),eC=(0,r.useCallback)(async(e,a)=>{var t;let i=w.find(a=>a.id===e);return i?{...(null===(t=S[e])||void 0===t?void 0:t[a])||d,criteria:i.criteria||[]}:null},[S,w]);return(0,i.jsx)(f.Provider,{value:{isLoading:t,error:v,groups:w,allStudents:b,activeStudentsInGroups:K,allObservations:C,specialNotes:D,settings:M,activeGroup:Z,activeGroupId:O,activePartialId:F,partialData:Q,allPartialsDataForActiveGroup:L,groupAverages:ey,atRiskStudents:eb,overallAverageAttendance:ek,setGroups:U,setAllStudents:x,setAllObservations:A,setAllPartialsData:B,setSpecialNotes:R,setSettings:V,setActiveGroupId:T,setActivePartialId:e=>j(e),setGrades:z,setAttendance:H,setParticipations:J,setActivities:q,setActivityRecords:X,setRecoveryGrades:Y,setStudentFeedback:$,setGroupAnalysis:ee,addStudentsToGroup:ea,removeStudentFromGroup:et,updateGroup:ei,updateStudent:er,updateGroupCriteria:en,deleteGroup:es,addStudentObservation:el,updateStudentObservation:eo,takeAttendanceForDate:ec,deleteAttendanceDate:eu,resetAllData:ed,importAllData:ep,addSpecialNote:ef,updateSpecialNote:ev,deleteSpecialNote:em,calculateFinalGrade:eh,calculateDetailedFinalGrade:eg,getStudentRiskLevel:ew,fetchPartialData:eC},children:a})},m=()=>{let e=(0,r.useContext)(f);if(void 0===e)throw Error("useData debe ser usado dentro de un DataProvider");return e}},20751:function(e,a,t){t.d(a,{GN:function(){return n},Q6:function(){return i},fm:function(){return l},u5:function(){return s}});let i="gemini-2.5-pro",r=[["gemini-1.0-pro","gemini-1.5-flash"],["gemini-pro","gemini-1.5-flash"],["gemini-1.5-pro","gemini-1.5-flash"],["gemini-1.5-flash","gemini-1.5-flash"],["gemini-2.0-flash","gemini-1.5-flash"]].reduce((e,a)=>{let[t,i]=a;return e[t.toLowerCase()]=i,e},{});function n(e){return e?r[e.trim().toLowerCase()]||e:i}function s(e){switch(n(e)){case"gemini-1.5-pro":return"Gemini 1.5 Pro";case"gemini-1.5-flash":case"gemini-1.5-flash":return"Gemini 1.5 Flash";case"gemini-1.5-flash-8b":return"Gemini 1.5 Flash 8B";default:return e}}let l=[{value:"gemini-1.5-flash",label:"Gemini 1.5 Flash (recomendado)"},{value:"gemini-1.5-pro",label:"Gemini 1.5 Pro"},{value:"gemini-2.0-flash",label:"Gemini 2.0 Flash"}]},89506:function(e,a,t){t.d(a,{I:function(){return l},db:function(){return o}});var i=t(15236),r=t(75735),n=t(69842);let s=(0,i.C6)().length?(0,i.Mq)():(0,i.ZF)({projectId:"actracker-master",appId:"1:660718374201:web:4889a6d15d8aee23ddace8",storageBucket:"actracker-master.firebasestorage.app",apiKey:"AIzaSyCDy-W8_3sB3WS8gVKZuzV_P6PdG1tBOUc",authDomain:"actracker-master.firebaseapp.com",messagingSenderId:"660718374201"}),l=(0,r.v0)(s),o=(0,n.ad)(s)},49354:function(e,a,t){t.d(a,{G:function(){return s},cn:function(){return n}});var i=t(44839),r=t(96164);function n(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,i.W)(a))}function s(e){switch(e){case"p1":return"Primer Parcial";case"p2":return"Segundo Parcial";case"p3":return"Tercer Parcial";default:return""}}}}]);