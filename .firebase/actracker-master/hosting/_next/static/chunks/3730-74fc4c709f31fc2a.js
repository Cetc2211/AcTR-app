"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3730],{67568:function(e,a,t){t.d(a,{DataProvider:function(){return m},e:function(){return g}});var i=t(57437),r=t(2265),n=t(93759),l=t(89506),s=t(56452),o=t(69842),c=t(20751);let u={institutionName:"Mi Instituci\xf3n",logo:"",theme:"theme-candy",apiKey:"",signature:"",facilitatorName:"",scheduleImageUrl:"",teacherPhoto:"",whatsappContactNumber:"",aiModel:c.Q6},d={grades:{},attendance:{},participations:{},activities:[],activityRecords:{},recoveryGrades:{},feedbacks:{},groupAnalysis:""},p=e=>{let a=(0,c.GN)(e.aiModel);return a===e.aiModel?e:{...e,aiModel:a}},f=(0,r.createContext)(void 0),m=e=>{let{children:a}=e,[t,c]=(0,r.useState)(!0),[m,g]=(0,r.useState)(null),[v,h]=(0,s.F_)(l.I),[w,b]=(0,r.useState)([]),[y,k]=(0,r.useState)([]),[C,_]=(0,r.useState)({}),[S,D]=(0,r.useState)([]),[I,G]=(0,r.useState)({}),[M,E]=(0,r.useState)(u),[O,P]=(0,r.useState)(null),[j,N]=(0,r.useState)("p1");(0,r.useEffect)(()=>{h||(async()=>{c(!0);try{let e=async e=>{let a;try{a=await (0,n.U2)(e)}catch(a){console.warn("Error reading local data for ".concat(e),a)}if(v)try{let t=(0,o.JU)(l.db,"users",v.uid,"userData",e),i=await (0,o.QT)(t);if(i.exists())return console.log("Loaded ".concat(e," from Firestore")),i.data().value;void 0!==a&&(console.log("Syncing local ".concat(e," to Firestore...")),await (0,o.pl)(t,{value:a}))}catch(a){console.error("Error loading/syncing ".concat(e," from Firestore:"),a)}return a},[a,t,i,r,s,c,d]=await Promise.all([e("app_groups"),e("app_students"),e("app_observations"),e("app_specialNotes"),e("app_partialsData"),e("app_settings"),(0,n.U2)("activeGroupId_v1")]);b(a||[]),k(t||[]),_(i||{}),D(r||[]),G(s||{});let f=p(c||u);E(f),c&&f.aiModel!==c.aiModel&&(0,n.t8)("app_settings",f),d&&(a||[]).some(e=>e.id===d)?P(d):(a||[]).length>0?P(a[0].id):P(null)}catch(e){console.error("Data hydration error:",e),g(e instanceof Error?e:Error("An unknown error occurred during data hydration"))}finally{c(!1)}})()},[v,h]);let F=(e,a,t)=>async i=>{let r="function"==typeof i?i(t):i;if(e(r),await (0,n.t8)(a,r),v)try{let e=(0,o.JU)(l.db,"users",v.uid,"userData",a);await (0,o.pl)(e,{value:r},{merge:!0}),console.log("Saved ".concat(a," to Firestore"))}catch(e){console.error("Error saving ".concat(a," to Firestore:"),e)}},U=F(b,"app_groups",w),x=F(k,"app_students",y),A=F(_,"app_observations",C),R=F(D,"app_specialNotes",S),L=F(G,"app_partialsData",I),B=(0,r.useCallback)(async e=>{let a=p(e);E(a),await (0,n.t8)("app_settings",a)},[]),V=(0,r.useCallback)(async e=>{P(e),e?await (0,n.t8)("activeGroupId_v1",e):await (0,n.IV)("activeGroupId_v1")},[]),J=(0,r.useMemo)(()=>O&&w.find(e=>e.id===O)||null,[w,O]),T=(0,r.useMemo)(()=>Array.from(new Map(w.flatMap(e=>e.students.map(e=>[e.id,e]))).values()),[w]),Z=(0,r.useMemo)(()=>I[O||""]||{},[I,O]),K=(0,r.useMemo)(()=>Z[j]||d,[Z,j]),Q=(0,r.useCallback)(e=>async a=>{O&&L(t=>{let i=t[O]||{},r=i[j]||d,l="function"==typeof a?a(r[e]):a,s={...r,[e]:l},o={...i,[j]:s},c={...t,[O]:o};return(0,n.t8)("app_partialsData",c),c})},[O,j,L]),W=Q("grades"),z=(0,r.useCallback)(async e=>{let a;if(O&&(await L(t=>{let i=t[O]||{},r=i[j]||d,l=r.attendance,s="function"==typeof e?e(l):e;a=s;let o={...r,attendance:s},c={...i,[j]:o},u={...t,[O]:c};return(0,n.t8)("app_partialsData",u),u}),a&&v)){let e=w.find(e=>e.id===O);if(e)for(let[t,i]of Object.entries(a)){let a=Object.entries(i).filter(e=>{let[a,t]=e;return!t}).map(e=>{let[a]=e;return a}),r=t.replace(/\//g,"-"),n="".concat(O,"_").concat(r),s=(0,o.JU)(l.db,"absences",n),c=e.students.filter(e=>a.includes(e.id)).map(e=>({id:e.id,name:e.name}));(0,o.pl)(s,{groupId:O,groupName:e.groupName||e.subject,date:t,teacherId:v.uid,teacherEmail:v.email,absentStudents:c,whatsappLink:e.whatsappLink||"",timestamp:new Date().toISOString()},{merge:!0}).catch(e=>console.error("Error syncing absences:",e))}}},[O,j,L,w,v]),H=Q("participations"),q=Q("activities"),X=Q("activityRecords"),Y=Q("recoveryGrades"),$=(0,r.useCallback)(async(e,a)=>{O&&L(t=>{let i=t[O]||{},r=i[j]||d,l={...r.feedbacks||{},[e]:a},s={...t,[O]:{...i,[j]:{...r,feedbacks:l}}};return(0,n.t8)("app_partialsData",s),s})},[O,j,L]),ee=(0,r.useCallback)(async e=>{O&&L(a=>{let t=a[O]||{},i=t[j]||d,r={...a,[O]:{...t,[j]:{...i,groupAnalysis:e}}};return(0,n.t8)("app_partialsData",r),r})},[O,j,L]),ea=(0,r.useCallback)(async(e,a)=>{await x(e=>[...e,...a.filter(a=>!e.some(e=>e.id===a.id))]),await U(t=>t.map(t=>t.id===e?{...t,students:[...t.students,...a]}:t))},[x,U]),et=(0,r.useCallback)(async(e,a)=>{await U(t=>t.map(t=>t.id===e?{...t,students:t.students.filter(e=>e.id!==a)}:t))},[U]),ei=(0,r.useCallback)(async(e,a)=>{await U(t=>t.map(t=>t.id===e?{...t,...a}:t))},[U]),er=(0,r.useCallback)(async(e,a)=>{await x(t=>t.map(t=>t.id===e?{...t,...a}:t)),await U(t=>t.map(t=>({...t,students:t.students.map(t=>t.id===e?{...t,...a}:t)})))},[x,U]),en=(0,r.useCallback)(async e=>{O&&await U(a=>a.map(a=>a.id===O?{...a,criteria:e}:a))},[O,U]),el=(0,r.useCallback)(async e=>{await U(a=>a.filter(a=>a.id!==e)),O===e&&V(null)},[O,U,V]),es=(0,r.useCallback)(async e=>{let a={...e,id:"OBS-".concat(Date.now()),date:new Date().toISOString(),followUpUpdates:[],isClosed:!1};await A(t=>({...t,[e.studentId]:[...t[e.studentId]||[],a]}))},[A]),eo=(0,r.useCallback)(async(e,a,t,i)=>{await A(r=>({...r,[e]:(r[e]||[]).map(e=>e.id===a?{...e,followUpUpdates:[...e.followUpUpdates,{date:new Date().toISOString(),update:t}],isClosed:i}:e)}))},[A]),ec=(0,r.useCallback)(async(e,a)=>{let t=w.find(a=>a.id===e);if(t&&(L(i=>{let r=i[e]||{},l=r[j]||d;if(l.attendance[a])return i;let s=t.students.reduce((e,a)=>({...e,[a.id]:!0}),{}),o={...i,[e]:{...r,[j]:{...l,attendance:{...l.attendance,[a]:s},participations:{...l.participations,[a]:{}}}}};return(0,n.t8)("app_partialsData",o),o}),v)){let i=a.replace(/\//g,"-"),r="".concat(e,"_").concat(i),n=(0,o.JU)(l.db,"absences",r);(0,o.pl)(n,{groupId:e,groupName:t.groupName||t.subject,date:a,teacherId:v.uid,teacherEmail:v.email,absentStudents:[],whatsappLink:t.whatsappLink||"",timestamp:new Date().toISOString()},{merge:!0}).catch(e=>console.error("Error syncing initial attendance:",e))}},[w,j,L,v]),eu=(0,r.useCallback)(async e=>{O&&L(a=>{let t=a[O]||{},i=t[j]||d,{[e]:r,...l}=i.attendance,{[e]:s,...o}=i.participations,c={...a,[O]:{...t,[j]:{...i,attendance:l,participations:o}}};return(0,n.t8)("app_partialsData",c),c})},[O,j,L]),ed=(0,r.useCallback)(async()=>{c(!0);try{await (0,n.ZH)(),setTimeout(()=>window.location.reload(),500)}catch(e){g(e)}},[]),ep=(0,r.useCallback)(async e=>{if(!e.version||!e.groups||!e.students||!e.settings)throw Error("Archivo de importaci\xf3n inv\xe1lido o corrupto.");await (0,n.ZH)(),await (0,n.t8)("app_groups",e.groups||[]),await (0,n.t8)("app_students",e.students||[]),await (0,n.t8)("app_observations",e.observations||{}),await (0,n.t8)("app_specialNotes",e.specialNotes||[]),await (0,n.t8)("app_settings",e.settings),await (0,n.t8)("app_partialsData",e.partialsData||{}),e.groups&&e.groups.length>0&&await (0,n.t8)("activeGroupId_v1",e.groups[0].id)},[]),ef=(0,r.useCallback)(async e=>{let a={...e,id:"NOTE-".concat(Date.now())};await R(e=>[...e,a])},[R]),em=(0,r.useCallback)(async(e,a)=>{await R(t=>t.map(t=>t.id===e?{...t,...a}:t))},[R]),eg=(0,r.useCallback)(async e=>{await R(a=>a.filter(a=>a.id!==e))},[R]),ev=(0,r.useCallback)((e,a,t)=>{var i,r,n;let l=null===(i=a.recoveryGrades)||void 0===i?void 0:i[e];if(null==l?void 0:l.applied)return{finalGrade:null!==(r=l.grade)&&void 0!==r?r:0,criteriaDetails:[{name:"Recuperaci\xf3n",earned:null!==(n=l.grade)&&void 0!==n?n:0,weight:100}],isRecovery:!0};if(!a||!t||0===t.length)return{finalGrade:0,criteriaDetails:[],isRecovery:!1};let s=0,o=[];return t.forEach(t=>{var i,r,n,l,c,u,d;let p=0;if("Actividades"===t.name||"Portafolio"===t.name){let t=null!==(n=null===(i=a.activities)||void 0===i?void 0:i.length)&&void 0!==n?n:0;t>0&&(p=Object.values((null===(r=a.activityRecords)||void 0===r?void 0:r[e])||{}).filter(Boolean).length/t)}else if("Participaci\xf3n"===t.name){let t=Object.keys(a.participations||{}).length;t>0&&(p=Object.values(a.participations).filter(a=>a[e]).length/t)}else{let i=null!==(d=null===(u=a.grades)||void 0===u?void 0:null===(c=u[e])||void 0===c?void 0:null===(l=c[t.id])||void 0===l?void 0:l.delivered)&&void 0!==d?d:0;t.expectedValue>0&&(p=i/t.expectedValue)}let f=p*t.weight;s+=f,o.push({name:t.name,earned:f,weight:t.weight})}),{finalGrade:Math.max(0,Math.min(100,s)),criteriaDetails:o,isRecovery:!1}},[]),eh=(0,r.useCallback)(e=>{var a;return J?ev(e,(null===(a=I[J.id])||void 0===a?void 0:a[j])||d,(null==J?void 0:J.criteria)||[]).finalGrade:0},[J,j,I,ev]),ew=(0,r.useCallback)((e,a,t)=>{let i=Object.keys(a).filter(e=>Object.prototype.hasOwnProperty.call(a[e],t)),r=i.reduce((e,i)=>!0===a[i][t]?e+1:e,0),n=i.length>0?r/i.length*100:100,l=[];return(e<=59&&l.push("Calificaci\xf3n reprobatoria (".concat(e.toFixed(0),"%).")),n<80&&l.push("Asistencia baja (".concat(n.toFixed(0),"%).")),l.length>0)?{level:"high",reason:l.join(" ")}:e>59&&e<=70?{level:"medium",reason:"Calificaci\xf3n baja (".concat(e.toFixed(0),"%).")}:{level:"low",reason:"Rendimiento adecuado"}},[]),eb=(0,r.useMemo)(()=>w.reduce((e,a)=>{var t;let i=null===(t=I[a.id])||void 0===t?void 0:t[j];if(!i||!a.criteria||0===a.criteria.length)return e[a.id]=0,e;let r=a.students.map(e=>ev(e.id,i,a.criteria).finalGrade);return e[a.id]=r.length>0?r.reduce((e,a)=>e+a,0)/r.length:0,e},{}),[w,j,I,ev]),ey=(0,r.useMemo)(()=>w.flatMap(e=>{var a;let t=null===(a=I[e.id])||void 0===a?void 0:a[j];return t&&e.criteria&&0!==e.criteria.length?e.students.map(a=>{let i=ew(ev(a.id,t,e.criteria).finalGrade,t.attendance,a.id);return{...a,calculatedRisk:i}}).filter(e=>"low"!==e.calculatedRisk.level):[]}).filter((e,a,t)=>t.findIndex(a=>a.id===e.id)===a),[w,j,I,ev,ew]),ek=(0,r.useMemo)(()=>{if(!J)return 100;let e=0,a=0,t=K.attendance;return(J.students.forEach(i=>{Object.keys(t).forEach(r=>{Object.prototype.hasOwnProperty.call(t[r],i.id)&&(e++,t[r][i.id]&&a++)})}),0===e)?100:a/e*100},[J,K.attendance]),eC=(0,r.useCallback)(async(e,a)=>{var t;let i=w.find(a=>a.id===e);return i?{...(null===(t=I[e])||void 0===t?void 0:t[a])||d,criteria:i.criteria||[]}:null},[I,w]);return(0,i.jsx)(f.Provider,{value:{isLoading:t,error:m,groups:w,allStudents:y,activeStudentsInGroups:T,allObservations:C,specialNotes:S,settings:M,activeGroup:J,activeGroupId:O,activePartialId:j,partialData:K,allPartialsDataForActiveGroup:Z,groupAverages:eb,atRiskStudents:ey,overallAverageAttendance:ek,setGroups:U,setAllStudents:x,setAllObservations:A,setAllPartialsData:L,setSpecialNotes:R,setSettings:B,setActiveGroupId:V,setActivePartialId:e=>N(e),setGrades:W,setAttendance:z,setParticipations:H,setActivities:q,setActivityRecords:X,setRecoveryGrades:Y,setStudentFeedback:$,setGroupAnalysis:ee,addStudentsToGroup:ea,removeStudentFromGroup:et,updateGroup:ei,updateStudent:er,updateGroupCriteria:en,deleteGroup:el,addStudentObservation:es,updateStudentObservation:eo,takeAttendanceForDate:ec,deleteAttendanceDate:eu,resetAllData:ed,importAllData:ep,addSpecialNote:ef,updateSpecialNote:em,deleteSpecialNote:eg,calculateFinalGrade:eh,calculateDetailedFinalGrade:ev,getStudentRiskLevel:ew,fetchPartialData:eC},children:a})},g=()=>{let e=(0,r.useContext)(f);if(void 0===e)throw Error("useData debe ser usado dentro de un DataProvider");return e}},20751:function(e,a,t){t.d(a,{GN:function(){return n},Q6:function(){return i},fm:function(){return s},u5:function(){return l}});let i="gemini-2.5-pro",r=[["gemini-1.0-pro","gemini-1.5-flash"],["gemini-pro","gemini-1.5-flash"],["gemini-1.5-pro","gemini-1.5-flash"],["gemini-1.5-flash","gemini-1.5-flash"],["gemini-2.0-flash","gemini-1.5-flash"]].reduce((e,a)=>{let[t,i]=a;return e[t.toLowerCase()]=i,e},{});function n(e){return e?r[e.trim().toLowerCase()]||e:i}function l(e){switch(n(e)){case"gemini-1.5-pro":return"Gemini 1.5 Pro";case"gemini-1.5-flash":case"gemini-1.5-flash":return"Gemini 1.5 Flash";case"gemini-1.5-flash-8b":return"Gemini 1.5 Flash 8B";default:return e}}let s=[{value:"gemini-1.5-flash",label:"Gemini 1.5 Flash (recomendado)"},{value:"gemini-1.5-pro",label:"Gemini 1.5 Pro"},{value:"gemini-2.0-flash",label:"Gemini 2.0 Flash"}]},89506:function(e,a,t){t.d(a,{I:function(){return s},db:function(){return o}});var i=t(15236),r=t(75735),n=t(69842);let l=(0,i.C6)().length?(0,i.Mq)():(0,i.ZF)({projectId:"actracker-master",appId:"1:660718374201:web:4889a6d15d8aee23ddace8",storageBucket:"actracker-master.firebasestorage.app",apiKey:"AIzaSyCDy-W8_3sB3WS8gVKZuzV_P6PdG1tBOUc",authDomain:"actracker-master.firebaseapp.com",messagingSenderId:"660718374201"}),s=(0,r.v0)(l),o=(0,n.ad)(l)},49354:function(e,a,t){t.d(a,{G:function(){return l},cn:function(){return n}});var i=t(44839),r=t(96164);function n(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,i.W)(a))}function l(e){switch(e){case"p1":return"Primer Parcial";case"p2":return"Segundo Parcial";case"p3":return"Tercer Parcial";default:return""}}}}]);