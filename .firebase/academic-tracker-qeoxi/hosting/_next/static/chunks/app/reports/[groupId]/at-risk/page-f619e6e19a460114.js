(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[972],{26559:function(e,s,t){Promise.resolve().then(t.bind(t,68073))},68073:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return _}});var r=t(57437),a=t(48185),n=t(35265),i=t(89733),l=t(66648),d=t(87138),o=t(73344),c=t(20530),u=t(98878),m=t(14585),f=t(98604),x=t(60926),h=t(74732),p=t(18787),g=t(16508),v=t(38087),j=t(86644),N=t(2265),b=t(86763),y=t(97501),w=t(81173),T=t.n(w),S=t(67568),k=t(79055),C=t(29973),A=t(16463);let R=e=>{let{studentData:s}=e,t=(0,N.useRef)(null),{toast:n}=(0,b.pm)(),d=s.attendance.total>0?s.attendance.p/s.attendance.total*100:100;return(0,r.jsxs)(a.Zb,{className:"overflow-hidden",children:[(0,r.jsxs)("div",{ref:t,className:"bg-background",children:[(0,r.jsx)(a.Ol,{className:"bg-muted/30",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:gap-6",children:[(0,r.jsx)(l.default,{src:s.photo,alt:s.name,width:100,height:100,className:"rounded-full border-4",style:{borderColor:"high"===s.riskLevel?"hsl(var(--destructive))":"hsl(var(--chart-4))"}}),(0,r.jsxs)("div",{className:"pt-2 flex-grow",children:[(0,r.jsx)(a.ll,{className:"text-2xl",children:s.name}),(0,r.jsxs)("div",{className:"flex flex-col items-start mt-1 space-y-1",children:[(0,r.jsx)(a.SZ,{className:"flex items-center gap-2",children:"high"===s.riskLevel?(0,r.jsx)(k.C,{variant:"destructive",children:"Riesgo Alto"}):(0,r.jsx)(k.C,{className:"bg-amber-500",children:"Riesgo Medio"})}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:s.riskReason})]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground mt-2 space-y-1",children:[(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"})," ",s.email||"No registrado"]}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"})," Tutor: ",s.tutorName||"No registrado"]}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4"})," Tel. Tutor: ",s.tutorPhone||"No registrado"]})]})]})]})}),(0,r.jsxs)(a.aY,{className:"p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,r.jsx)(m.Z,{})," Desglose de Calificaci\xf3n"]}),(0,r.jsxs)("div",{className:"p-3 border rounded-md text-sm space-y-2",children:[s.criteriaDetails.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{children:[e.name," ",(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.weight,"%)"]})]}),(0,r.jsxs)(k.C,{variant:"secondary",children:[e.earned.toFixed(1),"%"]})]},e.name)),(0,r.jsx)(C.Z,{}),(0,r.jsxs)("div",{className:"flex justify-between font-bold pt-1",children:[(0,r.jsx)("span",{children:"Calificaci\xf3n Final:"}),(0,r.jsxs)("span",{children:[s.finalGrade.toFixed(1),"%"]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,r.jsx)(f.Z,{})," Asistencia"]}),(0,r.jsxs)("div",{className:"p-3 border rounded-md text-sm space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Presente:"}),(0,r.jsxs)("span",{className:"font-bold flex items-center gap-1 text-green-600",children:[(0,r.jsx)(x.Z,{}),s.attendance.p]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Ausente:"}),(0,r.jsxs)("span",{className:"font-bold flex items-center gap-1 text-red-600",children:[(0,r.jsx)(h.Z,{}),s.attendance.a]})]}),(0,r.jsx)(C.Z,{}),(0,r.jsxs)("div",{className:"flex justify-between font-bold pt-1",children:[(0,r.jsx)("span",{children:"Tasa de Asistencia:"}),(0,r.jsxs)("span",{children:[d.toFixed(1),"%"]})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,r.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,r.jsx)(p.Z,{})," Observaciones en Bit\xe1cora"]}),s.observations.length>0?(0,r.jsx)("div",{className:"p-3 border rounded-md text-sm space-y-2",children:s.observations.map(e=>(0,r.jsx)("div",{children:(0,r.jsxs)("p",{children:[(0,r.jsxs)("span",{className:"font-semibold",children:[e.type,":"]})," ",e.details]})},e.id))}):(0,r.jsx)("div",{className:"p-3 border rounded-md text-sm text-center text-muted-foreground",children:"No hay observaciones registradas."})]})]})]}),(0,r.jsx)(a.eW,{className:"bg-muted/50 p-3 flex justify-end gap-2",children:(0,r.jsxs)(i.z,{variant:"outline",onClick:()=>{let e=t.current;if(e){n({title:"Generando PDF...",description:"Esto puede tardar un momento."});let t=new Promise((e,s)=>setTimeout(()=>s(Error("Timeout generador PDF")),15e3));Promise.race([T()(e,{scale:1.5,useCORS:!0}),t]).then(e=>{let t=e.toDataURL("image/png"),r=new y.ZP("p","mm","a4"),a=r.internal.pageSize.getWidth(),n=r.internal.pageSize.getHeight(),i=e.width/e.height,l=a-20,d=l/i;d>n-20&&(l=(d=n-20)*i),r.addImage(t,"PNG",10,10,l,d),r.save("informe_riesgo_".concat(s.name.replace(/\s+/g,"_"),".pdf"))}).catch(e=>{console.error("PDF Error:",e),n({variant:"destructive",title:"Error",description:"No se pudo generar el PDF."})})}},children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"})," PDF"]})})]})};function _(){let e=(0,A.useParams)().groupId,{groups:s,calculateDetailedFinalGrade:t,getStudentRiskLevel:o,allObservations:c,isLoading:u,fetchPartialData:m}=(0,S.e)(),[f,h]=(0,N.useState)([]),[p,g]=(0,N.useState)(!0),b=(0,N.useMemo)(()=>s.find(s=>s.id===e),[s,e]);return((0,N.useEffect)(()=>{let e=async()=>{if(b){g(!0);let e=new Map;for(let s of["p1","p2","p3"]){let r=await m(b.id,s);if(r&&(b.criteria.length>0||Object.keys(r.recoveryGrades||{}).length>0))for(let a of b.students){let{finalGrade:n,criteriaDetails:i}=t(a.id,r,b.criteria),l=o(n,r.attendance,a.id);if("high"===l.level||"medium"===l.level){let t=e.get(a.id);if(!t||"high"===l.level||"medium"===l.level&&"high"!==t.riskLevel){let t={p:0,a:0,total:0};Object.keys(r.attendance).forEach(e=>{var s;(null===(s=r.attendance[e])||void 0===s?void 0:s[a.id])!==void 0&&(t.total++,r.attendance[e][a.id]?t.p++:t.a++)}),e.set(a.id,{id:a.id,name:a.name,photo:a.photo,email:a.email,tutorName:a.tutorName,tutorPhone:a.tutorPhone,riskLevel:l.level,riskReason:l.reason,finalGrade:n,attendance:t,criteriaDetails:i,observations:(c[a.id]||[]).filter(e=>e.partialId===s)})}}}}h(Array.from(e.values()))}g(!1)};b&&!u?e():b||g(!1)},[b,t,o,c,m,u]),p||u)?(0,r.jsxs)("div",{className:"flex items-center justify-center h-full",children:[(0,r.jsx)(v.Z,{className:"h-8 w-8 animate-spin"})," ",(0,r.jsx)("span",{className:"ml-2",children:"Cargando informe..."})]}):b?(0,r.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.z,{asChild:!0,variant:"outline",size:"icon",children:(0,r.jsxs)(d.default,{href:"/reports",children:[(0,r.jsx)(j.Z,{}),(0,r.jsx)("span",{className:"sr-only",children:"Volver a Informes"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Informe de Estudiantes en Riesgo"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:['An\xe1lisis detallado para el grupo "',b.subject,'".']})]})]})}),f.length>0?(0,r.jsx)(n.UQ,{type:"single",collapsible:!0,className:"w-full space-y-4",children:f.map(e=>(0,r.jsxs)(n.Qd,{value:e.id,children:[(0,r.jsxs)(n.o4,{className:"p-4 bg-card rounded-lg hover:bg-muted/50 data-[state=open]:rounded-b-none",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(l.default,{src:e.photo,alt:e.name,width:40,height:40,className:"rounded-full"}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("p",{className:"font-bold",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.riskReason})]})]}),"high"===e.riskLevel?(0,r.jsx)(k.C,{variant:"destructive",children:"Alto"}):(0,r.jsx)(k.C,{className:"bg-amber-500",children:"Medio"})]}),(0,r.jsx)(n.vF,{className:"border-x border-b rounded-b-lg p-0",children:(0,r.jsx)(R,{studentData:e})})]},e.id))}):(0,r.jsx)(a.Zb,{children:(0,r.jsxs)(a.aY,{className:"p-12 text-center",children:[(0,r.jsx)(x.Z,{className:"h-16 w-16 mx-auto text-green-500 bg-green-100 rounded-full p-2"}),(0,r.jsx)("h2",{className:"text-2xl font-bold mt-4",children:"\xa1Todo en orden!"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"No se han identificado estudiantes en riesgo en este grupo."})]})})]}):(0,A.notFound)()}},35265:function(e,s,t){"use strict";t.d(s,{Qd:function(){return o},UQ:function(){return d},o4:function(){return c},vF:function(){return u}});var r=t(57437),a=t(2265),n=t(1337),i=t(90186),l=t(49354);let d=n.fC,o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(n.ck,{ref:s,className:(0,l.cn)("border-b",t),...a})});o.displayName="AccordionItem";let c=a.forwardRef((e,s)=>{let{className:t,children:a,...d}=e;return(0,r.jsx)(n.h4,{className:"flex",children:(0,r.jsxs)(n.xz,{ref:s,className:(0,l.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...d,children:[a,(0,r.jsx)(i.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});c.displayName=n.xz.displayName;let u=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsx)(n.VY,{ref:s,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:(0,r.jsx)("div",{className:(0,l.cn)("pb-4 pt-0",t),children:a})})});u.displayName=n.VY.displayName},79055:function(e,s,t){"use strict";t.d(s,{C:function(){return l}});var r=t(57437);t(2265);var a=t(13027),n=t(49354);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:t}),s),...a})}},89733:function(e,s,t){"use strict";t.d(s,{d:function(){return d},z:function(){return o}});var r=t(57437),a=t(2265),n=t(71538),i=t(13027),l=t(49354);let d=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,s)=>{let{className:t,variant:a,size:i,asChild:o=!1,...c}=e,u=o?n.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(d({variant:a,size:i,className:t})),ref:s,...c})});o.displayName="Button"},48185:function(e,s,t){"use strict";t.d(s,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return c},eW:function(){return u},ll:function(){return d}});var r=t(57437),a=t(2265),n=t(49354);let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});i.displayName="Card";let l=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})});l.displayName="CardHeader";let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});d.displayName="CardTitle";let o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...a})});c.displayName="CardContent";let u=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"},29973:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});var r=t(57437),a=t(2265),n=t(48484),i=t(49354);let l=a.forwardRef((e,s)=>{let{className:t,orientation:a="horizontal",decorative:l=!0,...d}=e;return(0,r.jsx)(n.f,{ref:s,decorative:l,orientation:a,className:(0,i.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",t),...d})});l.displayName=n.f.displayName},86763:function(e,s,t){"use strict";t.d(s,{pm:function(){return m}});var r=t(2265);let a=0,n=new Map,i=e=>{if(n.has(e))return;let s=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,s)},l=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},d=[],o={toasts:[]};function c(e){o=l(o,e),d.forEach(e=>{e(o)})}function u(e){let{...s}=e,t=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,s]=r.useState(o);return r.useEffect(()=>(d.push(s),()=>{let e=d.indexOf(s);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},function(e){e.O(0,[4358,139,7337,2505,6900,537,6452,7138,1119,3928,381,3945,1334,3730,2971,7023,1744],function(){return e(e.s=26559)}),_N_E=e.O()}]);